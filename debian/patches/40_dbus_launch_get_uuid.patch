--- dbus-launch-x11.c	2006/10/01 20:05:39	1.3
+++ dbus-launch-x11.c	2006/10/26 17:34:49	1.4
@@ -98,6 +98,10 @@
   char *result;
   char *p;
 
+  machine = get_machine_uuid ();
+  if (machine == NULL)
+    return NULL;
+
   display = xstrdup (getenv ("DISPLAY"));
   if (display == NULL)
     {
@@ -143,8 +147,6 @@
         *p = '_';
     }
   
-  machine = get_machine_uuid ();
-
   home = get_homedir ();
   
   result = malloc (strlen (home) + strlen (prefix) + strlen (machine) +
@@ -237,6 +239,10 @@
   if (init)
     return TRUE;
 
+  machine = get_machine_uuid ();
+  if (machine == NULL)
+    return FALSE;
+
   user = getpwuid (getuid ());
   if (user == NULL)
     {
@@ -245,8 +251,6 @@
     }
   user_name = xstrdup(user->pw_name);
 
-  machine = get_machine_uuid ();
-
   atom_name = malloc (strlen (machine) + strlen (user_name) + 2 +
                       MAX (strlen (selection_prefix),
                            MAX (strlen (address_prefix),
